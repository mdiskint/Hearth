<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hearth</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  
  <!-- WELCOME SCREEN -->
  <div id="welcome-screen" class="screen">
    <div class="welcome-content">
      <h1>ðŸ‘‹ Hi, I'm Hearth</h1>
      <p class="subtitle">I'm an AI that adapts to individuals, not averages.</p>
      <p>But I need to understand you first.</p>
      <p class="highlight">Answer 9 quick questions so I can learn how to work with <strong>you</strong> specifically.</p>
      <p class="time-estimate">Takes about 2 minutes.</p>
      <div class="button-group">
        <button id="start-quiz-btn" class="btn-primary">Let's go</button>
        <button id="skip-quiz-btn" class="btn-secondary">Maybe later</button>
      </div>
      <div class="auth-link">
        <button id="welcome-sign-in-btn" class="btn-link">Already have an account? Sign In</button>
      </div>
    </div>
  </div>

  <!-- AUTH SCREEN -->
  <div id="auth-screen" class="screen hidden">
    <div class="auth-content">
      <h1 id="auth-title">Sign In</h1>
      <p class="auth-subtitle">Sign in to sync your data across devices</p>

      <div id="auth-error" class="auth-error hidden"></div>

      <div class="auth-form">
        <div class="form-group">
          <label for="auth-email">Email</label>
          <input type="email" id="auth-email" placeholder="you@example.com" autocomplete="email">
        </div>
        <div class="form-group">
          <label for="auth-password">Password</label>
          <input type="password" id="auth-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">
        </div>

        <button id="auth-submit-btn" class="btn-primary auth-btn">Sign In</button>
      </div>

      <div class="auth-footer">
        <p id="auth-toggle-text">Don't have an account? <button id="auth-toggle-btn" class="btn-link">Sign Up</button></p>
        <button id="auth-skip-btn" class="btn-link">Skip for now</button>
      </div>
    </div>
  </div>
  
  <!-- QUIZ SCREEN -->
  <div id="quiz-screen" class="screen hidden">
    <div class="progress-bar">
      <div id="progress-fill" class="progress-fill"></div>
    </div>
    <div class="progress-text">
      <span id="current-question">1</span> / <span id="total-questions">10</span>
    </div>
    
    <div class="quiz-content">
      <div class="section-label" id="section-label"></div>
      <h2 class="question-text" id="question-text"></h2>
      <p class="question-instruction" id="question-instruction"></p>
      
      <div id="answers-container" class="answers-container"></div>
      
      <div class="quiz-navigation">
        <button id="back-btn" class="btn-secondary" disabled>Back</button>
        <button id="next-btn" class="btn-primary" disabled>Next</button>
      </div>
    </div>
  </div>
  
  <!-- RESULT SCREEN -->
  <div id="result-screen" class="screen hidden">
    <div class="result-content">
      <h1>âœ¨ Got it.</h1>
      <h2>Here's what I learned about you:</h2>
      
      <div class="archetype-card">
        <h3 id="archetype-title">Your AI Personality</h3>
        <p id="archetype-subtitle">You're a...</p>
      </div>
      
      <div class="highlights-section">
        <p>Here's how I'll work with you:</p>
        <div id="highlights-list"></div>
      </div>
      
      <div class="opspec-preview">
        <button id="toggle-opspec-btn" class="btn-link">See Full Operating Specification â–¼</button>
        <div id="opspec-full" class="opspec-full hidden">
          <div class="opspec-section">
            <h4>Identity</h4>
            <p id="opspec-identity"></p>
          </div>
          <div class="opspec-section">
            <h4>Constraints</h4>
            <ul id="opspec-constraints"></ul>
          </div>
          <div class="opspec-section">
            <h4>Communication Style</h4>
            <p id="opspec-communication"></p>
          </div>
          <div class="opspec-section">
            <h4>Execution</h4>
            <p id="opspec-execution"></p>
          </div>
          <div class="opspec-section">
            <h4>Balance Check</h4>
            <p id="opspec-balance"></p>
          </div>
        </div>
      </div>
      
      <div class="button-group">
        <button id="start-using-btn" class="btn-primary">Let's go!</button>
        <button id="retake-quiz-btn" class="btn-secondary">Retake quiz</button>
        <button id="edit-opspec-btn" class="btn-secondary">Edit OpSpec</button>
      </div>
    </div>
  </div>
  
  <!-- MAIN DASHBOARD (post-quiz) -->
  <div id="dashboard-screen" class="screen hidden">
    <div class="dashboard-header">
      <h2>Hearth</h2>
      <div class="header-right">
        <div class="status-indicator" id="status-indicator">
          <span class="status-dot active"></span>
          <span>Active</span>
        </div>
        <div class="user-indicator hidden" id="user-indicator">
          <span class="user-avatar" id="user-avatar">?</span>
          <button id="sign-out-btn" class="btn-link btn-small">Sign Out</button>
        </div>
        <button id="sign-in-header-btn" class="btn-secondary btn-small">Sign In</button>
      </div>
    </div>
    
    <div class="dashboard-content">
      <div class="section">
        <h3>Your Operating Specification</h3>
        <div class="opspec-summary" id="dashboard-opspec-summary"></div>
        <button id="view-edit-opspec-btn" class="btn-secondary">View/Edit OpSpec</button>
      </div>
      
      <div class="section">
        <div class="section-header">
          <h3>Memories</h3>
        </div>

        <!-- Empty State -->
        <div id="memory-empty-state" class="empty-state hidden">
          <p>No memories yet. Add your first memory to help me understand you better.</p>
          <div class="empty-state-actions">
            <button id="add-first-memory-btn" class="btn-primary">Add Memory</button>
            <button id="import-memories-btn" class="btn-secondary">Import from Chat History</button>
            <button id="extract-now-btn" class="btn-secondary">âš¡ Extract Now</button>
          </div>
        </div>

        <!-- Import Progress Indicator -->
        <div id="import-progress" class="import-progress hidden">
          <div class="progress-spinner"></div>
          <span id="import-status" class="import-status">Processing...</span>
        </div>

        <!-- Memory List -->
        <div id="memory-list" class="memory-list"></div>
      </div>

      <!-- FORGE SECTION -->
      <div class="forge-section">
        <div class="forge-header">
          <h3>ðŸ”¥ Forge</h3>
          <input type="checkbox" id="forge-toggle" class="forge-toggle">
        </div>
      </div>

      <div class="section">
        <h3>Settings</h3>
        <label class="toggle-setting">
          <input type="checkbox" id="enable-injection-toggle" checked>
          <span>Enable context injection</span>
        </label>
      </div>
      
      <div class="section">
        <button id="retake-quiz-dashboard-btn" class="btn-link">Retake personality quiz</button>
      </div>
    </div>
  </div>
  
  <!-- MEMORY MODAL -->
  <div id="memory-modal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="memory-modal-title">Add Memory</h3>
        <button id="close-memory-modal" class="close-btn">&times;</button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label for="memory-content">Memory <span class="char-count">(<span id="char-count">0</span>/500)</span></label>
          <textarea id="memory-content" rows="4" maxlength="500" placeholder="What should I remember about you?"></textarea>
        </div>

        <div class="form-group">
          <label for="memory-type">Type</label>
          <select id="memory-type">
            <option value="fact">Fact - What you know about them</option>
            <option value="pattern">Pattern - What you've learned</option>
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button id="cancel-memory-btn" class="btn-secondary">Cancel</button>
        <button id="save-memory-btn" class="btn-primary">Save Memory</button>
      </div>
    </div>
  </div>
  
  <script src="../utils/supabase-client.js"></script>
  <script src="../storage/storage.js"></script>
  <script src="../utils/quiz-questions.js"></script>
  <script src="../utils/opspec-generator.js"></script>
  <script src="../utils/chatParser.js"></script>
  <script src="../utils/memoryExtractor.js"></script>
  <script src="popup.js"></script>
</body>
</html>
